<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Samon Templates | Peter&#39;s Fascinations</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="description" content="Samon is the name I’ve given my-very-own static text-template engine.
I had been working with Jamon but kept running into obstacles related to my reliance on Scala features.
Background(What I call) Te">
<meta property="og:type" content="website">
<meta property="og:title" content="Samon Templates">
<meta property="og:url" content="http://peterlavalle.com/Samon-Templates/index.html">
<meta property="og:site_name" content="Peter's Fascinations">
<meta property="og:description" content="Samon is the name I’ve given my-very-own static text-template engine.
I had been working with Jamon but kept running into obstacles related to my reliance on Scala features.
Background(What I call) Te">
<meta property="og:updated_time" content="2017-03-14T09:33:46.482Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Samon Templates">
<meta name="twitter:description" content="Samon is the name I’ve given my-very-own static text-template engine.
I had been working with Jamon but kept running into obstacles related to my reliance on Scala features.
Background(What I call) Te">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-92917039-1', 'auto');
ga('send', 'pageview');

</script>
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <em class="page-title-link" data-url="/Samon-Templates/index.html">Samon Templates</em>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="page-undefined" class="article article-single article-type-page" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Samon Templates
        </h1>
    

            </header>
        
        
        
        <div class="article-entry" itemprop="articleBody">
            <p><a href="https://bitbucket.org/g-pechorin/samon2" target="_blank" rel="external">Samon</a> is the name I’ve given my-very-own <a href="https://en.wikipedia.org/wiki/Template_processor" target="_blank" rel="external">static text-template engine</a>.
I had been working with <a href="http://www.jamon.org/" target="_blank" rel="external">Jamon</a> but kept running into obstacles related to my reliance on Scala features.</p>
<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>(What I call) <a href="https://en.wikipedia.org/wiki/Template_processor" target="_blank" rel="external">Text-Template Engines</a> solve a pretty simple problem with to “buts”</p>
<ul>
<li>the problem isn’t “problematic” in simple applications</li>
<li>you need some basic programming knowledge before they make sense</li>
</ul>
<p>Confused? Terrified?</p>
<p>Let’s say that we have “SomeThing” with a <code>name</code> that’s a <code>String</code> and a <code>count</code> (of sub-things) that’s an <code>Int</code>.
Naturally - you’d use a class for this which I’ll express in Scala;</p>
<pre><code>class SomeThing
(
    val name: String,
    val cout: Int
)
</code></pre><p>You could write the equivalent class as C++ like this;</p>
<pre><code>class SomeThing
{
public:
    const std::string _name;
    const int _count;

    ...
}
</code></pre><p>… but that gets looooong and boring.
So I’m sticking with Scala.</p>
<p>I want to turn instance of this <code>SomeThing</code> into some HTML.
(Peter doesn’t care much about HTML, but it’s an easy example)</p>
<pre><code>...
val someThing: SomeThing = ...
var htmlString = &quot;&quot;

htmlString = htmlString + &quot;&lt;p&gt;Name:&lt;b&gt;&quot; + someThing.name + &quot;&lt;/b&gt;&quot;
htmlString = htmlString + &quot;&lt;ul&gt;&quot;
for(i &lt;- (0 until someThing.count))
{
    htmlString = htmlString + &quot;&lt;li&gt;&quot; + i + &quot;&lt;/li&gt;&quot;
}
htmlString = htmlString + &quot;&lt;/ul&gt;&lt;/p&gt;&quot;
...
</code></pre><p>That’s … not … not too horrid.
I mean - it’s horrid but for reasons I’ll explain.</p>
<p>But if this is all your project needs - fine, you’re done; get on with your life.
But what if the count isn’t “enough” for you?
Now you need SubThing’s labels printed out instead of a number?</p>
<pre><code>class SomeThing
(
    val name: String,
    val subThings: Array[SubThing]
)


...
val someThing: SomeThing = ...
var htmlString = &quot;&quot;

htmlString = htmlString + &quot;&lt;p&gt;Name:&lt;b&gt;&quot; + someThing.name + &quot;&lt;/b&gt;&quot;
htmlString = htmlString + &quot;&lt;ul&gt;&quot;
someThing.subThings.foreach {
    case subThing =&gt;
        htmlString = htmlString + &quot;&lt;li&gt;&quot; + subThing.label + &quot;&lt;/li&gt;&quot;
}
htmlString = htmlString + &quot;&lt;/ul&gt;&lt;/p&gt;&quot;
...
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$def someThing: SomeThing </div><div class="line">&lt;p&gt;Name:&lt;b&gt;$( someThing.name )&lt;/b&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">$each someThing.subThings</div><div class="line">$case subThing</div><div class="line">&lt;li&gt;$( subThing.label )&lt;/li&gt;</div><div class="line">$end</div></pre></td></tr></table></figure>
<h1 id="Shootout"><a href="#Shootout" class="headerlink" title="Shootout"></a>Shootout</h1><p>Several Scala-based template engines exist.
They are more mature and offer better tool support than mine.
Mine, however, is</p>
<ul>
<li>statically typed and compiled - performance advantage!</li>
<li>predictable W.R.T. line spacing - aesthetic advantage!</li>
</ul>
<p>I am disinclined to use dynamically typed things.
When emitting source-code, it’s quite nice to get predictable line spacing since it makes comparisons to expectations easier.</p>
<p>Several tools exist, but either don’t handle Scala’s <code>match</code> or insist on writing out XML tags - no good when you want to emit C++/GLSL/Scala source-code.
SSP and Twirl both handled <code>match</code> and let me emit text.
I worked with them long enough to adopt them before losing my patience.
When an SSP template was loaded, it had to be compiled then and there.
With several SSP templates several copies of the Scala compiler had to be spun up and set loose on these dynamic constructs.
SSP’s line endings were all over the place.
Twirl frustrated me in the same way - slow re-testing made development work hard.</p>
<p>Spending 65 seconds waiting for a UnitTest to re-run really cuts into your development time.</p>
<p>Getting the same results in 4 seconds (or less if using SBT’s daemon) is effectively uninterrupted.
I translate a template file into lines, arrange those lines into some trees, then write a <code>.scala</code> file based on those definitions which outputs something meaningful.
I used <a href="http://www.lihaoyi.com/" target="_blank" rel="external">Li Haoyi</a>‘s <a href="https://lihaoyi.github.io/fastparse/" target="_blank" rel="external">FastParse</a> for digesting lines themselves - I’m eager to use this tool on more projects.
The whole process is pretty quick and SBT’s incremental compiler produces a result from there.
I’ve packed my stuff into an SBT plugin and attached it to the <code>compile</code> thing; so it’s ID-10T compliant.</p>
<h1 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h1><p>The driving use was my [ScaD40][hgScaD40] project.
A usage  <a href="https://bitbucket.org/g-pechorin/dukscala/src/7d4a3fdfcfb5e9dba8c3cbe8ba158b21371bd48b/scad40/src/main/samon/com/peterlavalle/SJS.samon?at=diskio&amp;fileviewer=file-view-default" target="_blank" rel="external">example</a> is a 77 line file capable of transforming a case-class/construct-object into a Scala-JS source module.
(At the time of this writing - the example has at least one missing case I need to fix)
The files (which I write) tend to be mostly control code.</p>
<p>My original design was pretty much a translation of Jamon.
The current iteration was supposed to be stateless and accept only a single object as a template attribute.
This has … sort of fallen away - it’s not interesting to me anymore.
I made <code>sub</code> templates and <code>alt</code> templates with semantics related to how they handled the parameters of whatever they were inside.
I keep all control expressions on their own lines (always!) which drastically simplifies the process of parsing and constructing the templates.
Text lines (or whatever we’re calling the write-stuff-out bits) use simple substitutions reminiscent of Scala’s string interpolation.
To avoid any need for parsing Scala - I made <code>${}</code> <code>$&lt;&gt;</code> and <code>$()</code> work as substitution delimiters.
Thus far I haven’t needed to use all three symbols in the “insert text here” chunks.
If I had the time, I’d like to add a <code>#pragma</code> like directive to allow swapping which char to use for <code>$</code> and support <code>$[]</code> and <code>$//</code> as delimiters.</p>
<p>Can it help you?</p>

        </div>
        <footer class="article-footer">
            


    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>


        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="bitbucket" href="https://bitbucket.org/g-pechorin/" target="_blank">
                        <i class="icon fa fa-bitbucket"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="http://stackoverflow.com/users/482808/pal" target="_blank">
                        <i class="icon fa fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/g_pechorin" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github-alt" href="https://github.com/g-pechorin" target="_blank">
                        <i class="icon fa fa-github-alt"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BulletPhysics/">BulletPhysics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GamePlay/">GamePlay</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/">GitHub</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hardware/">Hardware</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lua/">Lua</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MadeWithUnity/">MadeWithUnity</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenVPN/">OpenVPN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pi3/">Pi3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Procedural-Generation/">Procedural Generation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpaceShips/">SpaceShips</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Template-Programming/">Template Programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VR/">VR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vive/">Vive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/howtos/">howtos</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/humor/">humor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mercurial/">mercurial</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/one-true-header/">one-true-header</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/">raspberry-pi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sorrynotsorry/">sorrynotsorry</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vBlog/">vBlog</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1983/03/">March 1983</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2017 Peter LaValle</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'peterlavalle';
    
    
    var disqus_url = 'http://peterlavalle.com/Samon-Templates/index.html';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
